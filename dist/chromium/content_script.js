"use strict";(()=>{var B=["google.com","google.com.hk"];var y="2.1.4";var x="New Bing Anywhere (Bing Chat GPT-4)";var f=(e=location.hostname)=>B.includes(e.replace(/^www\./,""));var $=()=>{try{return chrome.i18n.getUILanguage().toLowerCase()==="zh-cn"}catch{return!1}},M=()=>{try{let e=chrome.i18n.getUILanguage().toLowerCase();return e==="zh-cn"||e==="zh-tw"||e==="zh-hk"||e==="zh"}catch{return!1}};var v="configV1",g=async()=>({showGoogleButtonOnBing:!0,showBingButtonOnGoogle:!0,showGuideToGithub:!0,showChat:!0,showRelease:!0,triggerMode:"Always",conversationStyle:"Balanced","X-Forwarded-For":void 0,...(await chrome.storage.sync.get(v))[v]}),N=async e=>{let t=await g();await chrome.storage.sync.set({[v]:{...t,...e}})},L=e=>String(e).replace(/&/g,"&amp;").replace(/'/g,"&#39;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\//g,"&#x2f;");var m=async(e,t=[])=>await new Promise((a,n)=>{chrome.runtime.sendMessage({method:e,args:[...t]},r=>{!r||r.code!==200?n(r?.msg):a(r.data)})}),Y=(()=>{let e="v1";return{get:async t=>{t=`${e}:${t}`;let{data:a,maxAge:n,lastModified:r}=(await chrome.storage.local.get(t))?.[t]??{};return Date.now()-r>n*1e3?(chrome.storage.local.remove(t),null):a},set:async(t,a,n=1/0)=>{t=`${e}:${t}`,await chrome.storage.local.set({[t]:{data:a,lastModified:Date.now(),maxAge:n}})}}})();var C=navigator.userAgent,G=navigator.userAgentData,Q=C.includes("Macintosh"),Z=C.includes("Firefox"),A=C.includes("Edg/"),X=G?.brands.findIndex(e=>e.brand==="Brave")>-1,O=M(),J=$(),z=!!globalThis.__NBA_isCanary,ee=z?`0.${y}`:y;var w=async e=>{try{return await m("openUrlInSameTab",[{url:e}])}catch{location.href=e}},I={attributes:!0,childList:!0,subtree:!0},T=(e,t=document)=>t.querySelector(e),u=async(e,t=30,a=document)=>await new Promise(n=>{let r=T(e,a);if(r){n(r);return}let l=new MutationObserver((p,s)=>{let c=T(e,a);c&&(s.disconnect(),n(c))});l.observe(document,I),setTimeout(()=>{let p=T(e,a);l.disconnect(),n(p)},t*1e3)});var _=async e=>{if(!A){let n=window.document,r=n.createElement("script");r.src=chrome.runtime.getURL("inject.js"),r.onload=r.remove,n.documentElement.appendChild(r)}let t=document.documentElement.dir==="rtl";if(e(()=>{(async()=>{let{showGuideToGithub:n}=await g();if(!n)return;let r=e("#est_switch");e.trim(r.text())==="\u56FD\u5185\u7248\u56FD\u9645\u7248"&&setTimeout(()=>{let l=e('<a href="https://github.com/haozi/New-Bing-Anywhere/issues/8" title="\u67E5\u770B\u5982\u4F55\u6B63\u786E\u914D\u7F6E\u7F51\u7EDC\u4EE3\u7406" target="_blank" rel="noopener noreferrer nofollow">\u4F9D\u7136\u51FA\u73B0\u56FD\u5185\u7248/\u56FD\u9645\u7248\uFF1F</a>').css({color:"#E89ABE",textShadow:"0.5px 0.1px 1px #58070D",fontSize:"12px",fontWeight:"lighter"}).click(()=>{N({showGuideToGithub:!1})});e("#est_switch").append(l).css("width","auto")},2e3)})()}),!location.href.startsWith("https://www.bing.com/search?"))return;let a=await g();u("#sb_form").then(()=>{if(m("getNotification").then(s=>{if(!s)return;let c=e(document.body),o=e("<div/>").css({width:"100%",height:40,border:"1px solid #590727",background:"#58070d",position:"fixed",top:0,fontSize:"12px",lineHeight:"40px",textAlign:"center",zIndex:99999,whiteSpace:"nowrap",textOverflow:"ellipsis",display:"block !important"}),i=()=>{o.remove(),c.css("padding-top",null)},h=e(`<a style="color:#fff; background:url(${chrome.runtime.getURL("images/bing_32x32.png")}) no-repeat left 0; background-size: 12px; padding-inline-start: 20px" href="${s.html_url}" target="_blank" rel="noopener noreferrer nofollow">${s.title}</a>`).on("click",i),d=e('<a href="#" style="background:#58070d; color:#fff; cursor:pointer;padding: 0 68px 0 18px;position: absolute;right:0" title="no reminder">\u2715</a>').on("click",b=>{b.preventDefault(),confirm("Are you sure never see this notice again?")&&m("hideNotification"),i()});o.append(h).append(d),c.append(o).css("padding-top",40)}),e(document.body).on("click","a.b_logoArea",s=>{e(s.currentTarget).attr("href","/").attr("target","_self")}),!a.showGoogleButtonOnBing)return;let n=e("#sb_form_q"),r=n.val(),l=e(`
      <a href="https://www.google.com/search?q=${encodeURIComponent(L(r))}" target="google" tabindex="10" rel="noopener noreferrer nofollow" title="search with Google">
        <img src="${chrome.runtime.getURL("images/google.png")}" alt="google" style="width: 100%;display: block;">
      </a>`).css({position:"absolute",left:0,top:0,width:"70px",height:"23px",display:"inline-block","z-index":999,transition:"all .3s",transform:`translate3d(${835-(t?925:0)}px, 13px, 0px)`,"will-change":"transform",cursor:"pointer"});e("#sb_form").css("position","relative").prepend(l),l.on("click",async s=>{let c=e(s.currentTarget);s.preventDefault();let o="";o||(o=e.trim(n.val()));let i=`https://www.google.com/search?q=${encodeURIComponent(o)}`;c.attr("href",i),await w(i)}),location.search.includes("showconv=1")&&(l.css("display","none"),setTimeout(()=>{l.css("display","inline-block")},1200));let p=()=>{let s=e("#b-scopeListItem-conv"),c=s.hasClass("b_active");if(c){let o=0;s.offset().left?o=s.offset().left+s.width()+30:o=350,l.css({transform:`translate3d(${o-(t?925:0)}px, 15px, 0)`})}else l.css({transform:`translate3d(${835-(t?925:0)}px, 15px, 0)`});!c&&e(".b_searchboxForm").hasClass("as_rsform")&&l.css({transform:`translate3d(${1155-(t?-99999:0)}px, 15px, 0)`})};p(),new MutationObserver((s,c)=>{for(let o of s){let i=o.target;i&&(i.id==="b-scopeListItem-conv"&&p(),i.classList.contains("b_searchboxForm")&&p())}}).observe(document.getElementById("b_header"),I)})};var D=f(),S=async(e,t)=>{let a="",n="",r="";D&&(a=new URLSearchParams(location.search).get("q")??"",n=document.documentElement.dir,r=document.querySelector('meta[name="color-scheme"]')?.content==="dark"?"dark":"");let l=new URLSearchParams(location.hash.slice(1)).get("new-bing-anywhere")??"",p={prompt:a.trim(),dir:n,darkmode:r,extra:l},s=o=>{for(let i in o)o.hasOwnProperty(i)&&(o[i]||delete o[i]);return new URLSearchParams(o).toString()},c=chrome.runtime.getURL(`/app/index.html#/chat/iframe?${s(p)}`);try{let o=e(`<iframe src="${c}" scrolling="no" />`);o.css({width:"100%",border:"none",overflow:"hidden",boxSizing:"border-box",willChange:"height",transition:"height .1s cubic-bezier(0, 0, 0, 1.27) 0s",borderRadius:"8px"}),window.addEventListener("message",b=>{let{type:R,data:P}=b.data;if(R!=="nba-resize")return;let{height:E}=P;o.css({height:E})});let i;i=e(await u("#rhs",1)),i.length||(i=e('<div id="rhs" />').css({marginInlineStart:"var(--rhs-margin)",flex:"0 auto",width:"var(--rhs-width)",position:"relative",paddingBottom:"15px",transition:"opacity 0.3s"}));let h=e(await u(".liYKde.g.VjDLd",.1));h.length?h.prepend(o):i.prepend(o);let d=await u("#center_col");i.insertAfter(d),e(d).after(i)}catch{}};var U=async e=>{if(!(await g()).showBingButtonOnGoogle||location.pathname!=="/search")return;let a=document.documentElement.dir==="rtl";u('[action="/search"]').then(n=>{if(!n)return;let r=e(n),l=r.find('[name="q"]'),p=r.find('button[type="submit"]'),s=e(`
      <a href="https://www.bing.com/search?q=Bing+AI&showconv=1" rel="noopener noreferrer nofollow" target="bing" title="search with New Bing">
        <img src="${chrome.runtime.getURL("images/bing-chat.png")}" style="display: block; width: 20px; height: 20px" alt="bing" />
      </a>`).css({width:"40px",display:"flex",position:"relative","z-index":999,cursor:"pointer","justify-content":"center","align-items":"center",margin:"-2px 10px 0 -10px",...a?{marginInlineStart:"-10px",marginInlineEnd:"10px"}:null});p.after(s),s.on("click",async c=>{let o=e(c.currentTarget);c.preventDefault();let i=`https://www.bing.com/search?q=${encodeURIComponent(l.val())}&showconv=1`;o.attr("href",i),await w(i)})})};(async e=>{let t=e(document.documentElement);if(t.find(`meta[name="${x}"]`).length)return;let a=e(`<meta name="${x}" />`);t.prepend(a),m("getEnv").then(n=>{a.attr("content",n.version)}),g().then(n=>{n.showChat&&S(e,n)}),location.hostname==="www.bing.com"&&_(e),f()&&U(e)})(window.Zepto);})();
